{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://imageai.app/schemas/layout-template-v1.json",
  "title": "ImageAI Layout Template",
  "description": "Schema for ImageAI layout templates",
  "type": "object",
  "required": ["name", "page_size_px", "blocks"],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Schema version (e.g., '1.0')",
      "default": "1.0"
    },
    "name": {
      "type": "string",
      "description": "Human-readable template name",
      "minLength": 1
    },
    "description": {
      "type": "string",
      "description": "Detailed description of the template's purpose"
    },
    "category": {
      "type": "string",
      "description": "Template category",
      "enum": ["children", "comic", "magazine", "custom"],
      "default": "custom"
    },
    "tags": {
      "type": "array",
      "description": "Search tags for the template",
      "items": {
        "type": "string"
      }
    },
    "author": {
      "type": "string",
      "description": "Template creator"
    },
    "thumbnail": {
      "type": "string",
      "description": "Path to thumbnail image (relative to template directory)"
    },
    "page_size_px": {
      "type": "array",
      "description": "Page dimensions [width, height] in pixels",
      "items": {
        "type": "integer",
        "minimum": 100
      },
      "minItems": 2,
      "maxItems": 2
    },
    "margin_px": {
      "type": "integer",
      "description": "Margin in pixels",
      "minimum": 0,
      "default": 64
    },
    "bleed_px": {
      "type": "integer",
      "description": "Bleed area in pixels (for print)",
      "minimum": 0,
      "default": 0
    },
    "background": {
      "type": "string",
      "description": "Background color (hex) or 'transparent'",
      "pattern": "^(#[0-9A-Fa-f]{6}|#[0-9A-Fa-f]{8}|transparent|{{.+}})$"
    },
    "variables": {
      "type": "object",
      "description": "Template variables for substitution",
      "additionalProperties": true
    },
    "extends": {
      "type": "string",
      "description": "Base template to inherit from (filename without extension)"
    },
    "blocks": {
      "type": "array",
      "description": "Layout blocks (text or image)",
      "items": {
        "oneOf": [
          {"$ref": "#/definitions/textBlock"},
          {"$ref": "#/definitions/imageBlock"}
        ]
      },
      "minItems": 1
    }
  },
  "definitions": {
    "rect": {
      "type": "array",
      "description": "Rectangle [x, y, width, height] in pixels",
      "items": {
        "type": "integer",
        "minimum": 0
      },
      "minItems": 4,
      "maxItems": 4
    },
    "textBlock": {
      "type": "object",
      "required": ["type", "id", "rect"],
      "properties": {
        "type": {
          "const": "text"
        },
        "id": {
          "type": "string",
          "description": "Unique block identifier",
          "minLength": 1
        },
        "rect": {"$ref": "#/definitions/rect"},
        "text": {
          "type": "string",
          "description": "Default text content"
        },
        "style": {
          "type": "object",
          "properties": {
            "family": {
              "type": "array",
              "description": "Font family fallback chain",
              "items": {"type": "string"},
              "minItems": 1
            },
            "weight": {
              "type": "string",
              "enum": ["thin", "light", "regular", "medium", "semibold", "bold", "black"],
              "default": "regular"
            },
            "italic": {"type": "boolean", "default": false},
            "size_px": {"type": "integer", "minimum": 6},
            "line_height": {"type": "number", "minimum": 0.5, "default": 1.3},
            "letter_spacing": {"type": "number", "default": 0},
            "color": {
              "type": "string",
              "pattern": "^(#[0-9A-Fa-f]{6}|#[0-9A-Fa-f]{8}|{{.+}})$"
            },
            "align": {
              "type": "string",
              "enum": ["left", "center", "right", "justify"],
              "default": "left"
            },
            "vertical_align": {
              "type": "string",
              "enum": ["top", "center", "bottom"],
              "default": "top"
            },
            "paragraph_spacing": {"type": "number", "minimum": 0, "default": 0}
          }
        }
      }
    },
    "imageBlock": {
      "type": "object",
      "required": ["type", "id", "rect"],
      "properties": {
        "type": {
          "const": "image"
        },
        "id": {
          "type": "string",
          "description": "Unique block identifier",
          "minLength": 1
        },
        "rect": {"$ref": "#/definitions/rect"},
        "image_path": {
          "type": "string",
          "description": "Default image path"
        },
        "style": {
          "type": "object",
          "properties": {
            "fit": {
              "type": "string",
              "enum": ["cover", "contain", "fill", "fit_width", "fit_height"],
              "default": "cover"
            },
            "border_radius_px": {"type": "integer", "minimum": 0, "default": 0},
            "stroke_px": {"type": "integer", "minimum": 0, "default": 0},
            "stroke_color": {
              "type": "string",
              "pattern": "^(#[0-9A-Fa-f]{6}|#[0-9A-Fa-f]{8}|{{.+}})$"
            },
            "filter": {
              "type": "string",
              "enum": ["none", "blur", "grayscale", "sepia", "sharpen"],
              "default": "none"
            },
            "filter_intensity": {"type": "number", "minimum": 0, "maximum": 1, "default": 1.0},
            "brightness": {"type": "number", "minimum": 0, "maximum": 2, "default": 1.0},
            "contrast": {"type": "number", "minimum": 0, "maximum": 2, "default": 1.0},
            "saturation": {"type": "number", "minimum": 0, "maximum": 2, "default": 1.0}
          }
        }
      }
    }
  }
}
